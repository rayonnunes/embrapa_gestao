<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8" />
    <title>Cadastrar Rebanho - Detalhado</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      content="A fully featured admin theme which can be used to build CRM, CMS, etc."
      name="description"
    />
    <meta content="Coderthemes" name="author" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- App favicon -->
    <link rel="shortcut icon" href="assets/images/favicon.ico" />

    <!-- Bootstrap select pluings -->
    <link
      href="assets/libs/bootstrap-select/bootstrap-select.min.css"
      rel="stylesheet"
      type="text/css"
    />

    <!-- App css -->
    <link
      href="assets/css/bootstrap.min.css"
      rel="stylesheet"
      type="text/css"
    />
    <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/app.min.css" rel="stylesheet" type="text/css" />
  </head>

  <body class="bg-white">
    <div id="wrapper">@@include('./partials/topbar-initial.html')</div>
    <div class="account-pages my-5">
      <div class="container">
        <div class="row justify-content-center">
          <div class="col-md-8 col-lg-6 col-xl-5">
            <div>
              <div class="text-center mb-4">
                <h2>Cadastro de Novo Rebanho Detalhado</h2>
              </div>

              <form id="form-rebanho-detalhado">
                <h4 class="mb-3">Ovinos / Caprinos</h4>

                <div class="form-group mb-3">
                  <label for="nomeRebanho">Nome do Rebanho</label>
                  <input
                    class="form-control"
                    type="text"
                    id="nomeRebanho"
                    placeholder="Nome do Rebanho"
                    required
                    name="nome-rebanho"
                  />
                </div>
                <div class="form-group mb-3">
                  <label for="idAnimal">Identificação do Animal</label>
                  <input
                    class="form-control"
                    type="text"
                    id="idAnimal"
                    placeholder="Nome ou número do animal"
                    required
                    name="id-animal"
                  />
                </div>

                <div class="form-group mb-3">
                  <label for="bornsDate">Data de Nascimento</label>
                  <input
                    class="form-control"
                    type="date"
                    id="bornsDate"
                    placeholder=""
                    required
                    name="data-nascimento"
                  />
                </div>

                <div class="form-group mb-3">
                  <label for="especie-rebanho-det">Espécie do Rebanho</label>
                  <select class="form-control select2" id="especie-rebanho-det" name="especie">
                    <option>Selecione</option>
                    <optgroup>
                      <option value="OVI">Ovinos</option>
                      <option value="CAP">Caprinos</option>
                    </optgroup>
                  </select>
                </div>
                

                <div class="form-group mb-3">
                  <label for="raca-rebanho-det">Raça</label>
                  <select
                    class="form-control select2"
                    id="raca-rebanho-det"
                    name="raca"
                    onchange="addOutro()"
                  >                  
                    <option>Selecione</option>
                    <optgroup label="Ovinos">
                      <option value="SPRD/mestiço">SPRD/mestiço</option>
                      <option value="Santa Inês">Santa Inês</option>
                      <option value="Morada Nova">Morada Nova</option>
                      <option value="Dorper">Dorper</option>
                      <option value="Texel">Texel</option>
                      <option value="Corriedale">Corriedale</option>
                      <option value="Hampshire">Hampshire</option>
                      <option value="Bergamácia">Bergamácia</option>
                      <option value="Somalis">Somalis</option>
                      <option value="Suffolk">Suffolk</option>
                      <option value="Ideal">Ideal</option>
                    </optgroup>                    
                    <optgroup label="Caprinos">
                      <option value="SPRD/mestiço">SPRD/mestiço</option>
                      <option value="Saanen">Saanen</option>
                      <option value="Boer">Boer</option>
                      <option value="Toggenburg">Toggenburg</option>
                      <option value="Alpina">Alpina</option>
                      <option value="Jamnapari">Jamnapari</option>
                      <option value="Murciano-Granadina">Murciano-Granadina</option>
                      <option value="Moxotó">Moxotó</option>
                      <option value="Azul">Azul</option>
                      <option value="Marota">Marota</option>
                      <option value="Repartida">Repartida</option>
                    </optgroup>
                      <option value="-1">Outro</option>
                  </select>
                </div>

                <div class="form-group d-none" id="outro-raca-div">
                  <label for="outra-benfeitoria-nome-1">Outro</label>
                  <input
                    id="outro-raca"
                    type="text"
                    class="form-control"
                    name="outro"                    
                  />
                </div>

                <div class="form-group mb-3">
                  <label for="categoria-rebanho-det">Categoria do Animal</label>
                  <select
                    class="form-control select2"
                    id="categoria-rebanho-det"
                    name="categoria"
                  >
                    <option>Selecione</option>
                    <optgroup>
                      <option value="matriz">Matriz</option>
                      <option value="reprodutor">Reprodutor</option>
                      <option value="femeaLactacao">Fêmea em Lactação</option>
                      <option value="machoLactacao">Macho em Lactação</option>
                      <option value="machoJovem">Macho Jovem</option>
                      <option value="femeaJovem">Fêmea Jovem</option>
                      <option value="machoAdulto">Macho Adulto</option>
                      <option value="femeaAdulta">Fêmea Adulta</option>
                    </optgroup>
                  </select>
                </div>

                <div class="row justify-content-center">
                  <button class="btn btn-success" name="button" id="adicionar-animal">
                    <span class="position-relative" style="bottom: 3px"
                      >Adicionar Outro Animal &nbsp;</span
                    >
                    <i class="mdi mdi-sheep mdi-24px"></i>+
                  </button>
                </div>

                <div class="form-group text-center my-5">
                  <a
                    href="cadastrar-propriedade2.html"
                    class="btn btn-dark width-md btn-rounded"
                    type="reset"
                  >
                    <i class="fas fa-arrow-circle-left"></i>
                    Voltar
                  </a>
                  <button
                    class="btn btn-outline-primary width-md btn-rounded ml-1"
                    id="cadastrar-retornar-rd"
                  >
                    Cadastrar e Retornar
                  </button>
                  <button
                    class="btn btn-primary width-md btn-rounded ml-1"                    
                    id="cadastrar-novo-rd"
                  >
                    Novo Rebanho &nbsp;
                    <i class="fas fa-arrow-circle-right"></i>
                  </button>
                </div>
              </form>
            </div>
            <!-- end card -->
          </div>
          <!-- end col -->
        </div>
        <!-- end row -->
      </div>
      <!-- end container -->
    </div>
    <!-- end page -->

    <!-- Vendor js -->
    <script src="assets/js/vendor.min.js"></script>

    <!-- Bootstrap select plugin -->
    <script src="assets/libs/bootstrap-select/bootstrap-select.min.js"></script>
    <script src="assets/libs/select2/select2.min.js"></script>
    <!-- Plugins js -->
    <script src="assets/libs/jquery-mask-plugin/jquery.mask.min.js"></script>
    <script src="assets/libs/autonumeric/autoNumeric-min.js"></script>
    <script src="assets/js/pages/form-masks.init.js"></script>

    <!-- App js -->
    <script src="assets/js/app.min.js"></script>

    <script type="text/javascript">
      function addOutro(){
        let select = document.getElementById('raca-rebanho-det').value
        
        let outraRaca = document.getElementById('outro-raca-div')

        if(select === '-1'){          
          outraRaca.className = "form-group d-block"
        }else{
          outraRaca.className = "form-group d-none"
        }        
      }

      function cadastrarRetornar(){
        $('#cadastrar-retornar-rd').click(function(event){          
          event.preventDefault()
          
          let data = $('#form-rebanho-detalhado').serialize()

          let url = 'http://localhost/php-getovi/api/cadastro_rebanho_detalhado.php';                    
          $.ajax({
            url: url,
            method: 'POST',
            data: data,
            dataType: 'json'
          }).done(function(res){            
            if(res.status == 'Success'){              
              window.alert(res.value)
              console.log(res)

              window.location.href = 'cadastrar-propriedade2.html'                          
            }else{              
              console.log(res.value)              
              window.alert('Erro')
            }
          })     
        })
      }

      function cadastrarNovoRebanho(){
        $('#cadastrar-novo-rd').click(function(event){          
          event.preventDefault()
          
          let data = $('#form-rebanho-detalhado').serialize()                                                  
          let url = 'http://localhost/php-getovi/api/cadastro_rebanho_detalhado.php';                    
          $.ajax({
            url: url,
            method: 'POST',
            data: data,
            dataType: 'json'
          }).done(function(res){            
            if(res.status == 'Success'){              
              window.alert(res.value)
              console.log(res)

              window.location.href = 'cadastrar-rebanho-detalhado.html'                          
            }else{              
              console.log(res.value)              
              window.alert('Erro')
            }
          })     
        })
      }

      function cadastrarCategoria(){
        $('#adicionar-animal').click(function(event){          
          event.preventDefault()
          
          let data = $('#form-rebanho-detalhado').serialize()          
          let nomeRebanho = document.getElementById('nomeRebanho').value
          console.log(data)                                

          let url = 'http://localhost/php-getovi/api/cadastro_rebanho_detalhado.php';                    
          $.ajax({
            url: url,
            method: 'POST',
            data: data,
            dataType: 'json'
          }).done(function(res){            
            if(res.status == 'Success'){              
              window.alert(res.value)
              console.log(res)

              // window.location.href = 'cadastrar-rebanho-detalhado.html?nome='+nomeRebanho                          
            }else{              
              console.log(res.value)              
              window.alert('Erro')
            }
          })     
        })
      }   

      function preparaNomeRebanho(){
        let queryString = location.search.slice(1)
  
          let parts = queryString.split('&')
          
          let data = {}
          
          parts.forEach(function (part) {
            let keyValue = part.split('=');
            let key = keyValue[0];
            let value = keyValue[1];
            data[key] = value;
          });
          
          if(data.nome){
            let novoNome = data.nome
            novoNome = novoNome.replace(/%20/gi, " ");
            let nomeRebanho = document.getElementById('nomeRebanho')
            nomeRebanho.value = novoNome  
            nomeRebanho.disabled = true
          }          
          
      }

      cadastrarNovoRebanho()
      cadastrarRetornar()
      cadastrarCategoria()
      preparaNomeRebanho()

    </script>
  </body>
</html>
